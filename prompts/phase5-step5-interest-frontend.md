# Phase 5 ‚Äî Step 5: Interest Count UI & Toggle Button

## Context

Village Square is a community board app (Go + SQLite + vanilla HTML/CSS/JS). We've just added backend support for interest tracking:

**New endpoint:**
```
POST /api/posts/{id}/interest   (auth required, toggles interest on/off)
```
Returns:
```json
{ "interested": true, "interest_count": 5 }
```

**Updated post JSON** ‚Äî every post now includes two new fields:
```json
{
  "id": 1,
  "user_id": 1,
  "author": "Jan Visser",
  "type": "offer",
  "title": "...",
  "body": "...",
  "category": "fish",
  "event_id": null,
  "event_title": null,
  "interest_count": 3,
  "user_interested": false,
  "created_at": "..."
}
```

- `interest_count` ‚Äî total number of users interested in this post.
- `user_interested` ‚Äî `true` if the currently logged-in user has already expressed interest.

**Current contact button** in `postCardHTML()`:
- Shows "I'm interested" on offers / "I can help!" on requests (only for other users' posts, hidden on announcements and own posts).
- Clicking it calls `GET /api/posts/{id}/contact` and opens a `mailto:` link.
- The button has class `contact-btn` and is only visible when the card is expanded.

**Current button HTML generated by `postCardHTML(p)`:**
```js
(p.type !== 'announcement' && currentUserID && p.user_id !== currentUserID
  ? '<button class="contact-btn" data-contact-id="' + p.id + '">' + (p.type === 'offer' ? "I\u2019m interested" : 'I can help!') + '</button>'
  : '')
```

**Current `attachPostCardListeners()`** binds click handlers for `.post-title` (expand), `.collapse-link`, `.post-delete-btn`, and `.contact-btn`.

**The app uses `shared.js`** which provides `VS.toast(message, type)` and `VS.escapeHTML(str)`.

## What I need you to do

Replace the simple contact-only button with a two-action area: an interest toggle button (with count) and a separate contact link. All changes are in `static/dashboard.html` only.

### 1. Update `postCardHTML()` ‚Äî replace the contact button

Replace the current contact button markup with a new **interest action area** for offer/request posts where the user is not the author. For announcements or own posts, show nothing (same as before).

For another user's offer/request, generate this HTML:

```html
<div class="interest-actions">
  <button class="interest-btn" data-interest-id="3" data-interested="false">
    ‚ù§ I'm interested
  </button>
  <span class="interest-count" data-count-id="3">0</span>
  <button class="contact-btn" data-contact-id="3">üìß Contact</button>
</div>
```

Logic for the interest button:
- If `p.user_interested` is true:
  - Add `data-interested="true"` attribute.
  - Button text: `"‚ù§ Interested"` (past tense, showing they already clicked).
  - Add a CSS class `interested` to the button.
- If `p.user_interested` is false:
  - Add `data-interested="false"` attribute.
  - Button text: `"ü§ç I'm interested"` for offers, `"ü§ç I can help!"` for requests.
  - No extra CSS class.
- The interest count span shows `p.interest_count`. If the count is 0, still show `"0"`.
- The contact button always says `"üìß Contact"` (not the old "I'm interested" text ‚Äî that's now on the interest button).

For the **post author's own posts** (offers/requests), show a **read-only interest count** (no buttons):
```html
<div class="interest-actions interest-actions-own">
  <span class="interest-count-label">‚ù§ <span class="interest-count" data-count-id="3">2</span> interested</span>
</div>
```
Only show this if `interest_count > 0`. If 0, show nothing.

### 2. Update `attachPostCardListeners()` ‚Äî bind new event handlers

Replace the old `.contact-btn` binding with two new bindings:

```js
// Interest toggle buttons
var interestBtns = feedContainer.querySelectorAll('.interest-btn');
for (var i = 0; i < interestBtns.length; i++) {
  interestBtns[i].addEventListener('click', handleInterestClick);
}

// Contact buttons (same as before, just re-selecting with new class)
var contactBtns = feedContainer.querySelectorAll('.contact-btn');
for (var i = 0; i < contactBtns.length; i++) {
  contactBtns[i].addEventListener('click', handleContactClick);
}
```

### 3. Create `handleInterestClick(e)` function

This function handles clicking the interest toggle button:

1. Get the post ID from `e.currentTarget.getAttribute('data-interest-id')`.
2. Get the current state from `e.currentTarget.getAttribute('data-interested')`.
3. Disable the button.
4. `POST` to `/api/posts/<id>/interest` with `credentials: 'same-origin'` and `Content-Type: application/json` and an empty JSON body `{}`.
5. On success, parse the response `{ interested, interest_count }`:
   - Update the button's `data-interested` attribute.
   - Toggle the `interested` CSS class on the button.
   - Update the button text:
     - If `interested === true`: `"‚ù§ Interested"`
     - If `interested === false`: restore the original text based on post type. Look up the post in `currentPosts` to get the type, then use `"ü§ç I'm interested"` for offers or `"ü§ç I can help!"` for requests.
   - Update the matching `.interest-count` span (find it by `data-count-id`): set its `textContent` to `interest_count`.
   - Show a toast: `VS.toast(interested ? 'Interest registered!' : 'Interest removed.', 'success')`.
6. On error, show error toast and re-enable the button.
7. Re-enable the button after success too.

### 4. Update `handleContactClick(e)` ‚Äî no logic changes

The existing `handleContactClick` function should continue to work as-is. It already uses `data-contact-id` which is still present on the new contact button. **No changes needed** to this function.

### 5. Add CSS styles

Add these styles in the `<style>` block, replacing the existing `.contact-btn` section:

**`.interest-actions`:**
- `display: none` (hidden when card is collapsed).
- `.post-card.expanded .interest-actions { display: flex; }` ‚Äî visible when expanded.
- `align-items: center`
- `gap: 0.6rem`
- `margin-top: 0.6rem`
- `flex-wrap: wrap`

**`.interest-btn`:**
- Same base style as the old `.contact-btn`: padding, font-size, font-weight, color (#2d6a4f), background none, border 2px solid #2d6a4f, border-radius 8px, cursor pointer, transition.
- `.interest-btn.interested`: filled style ‚Äî `background: #2d6a4f`, `color: #fff`.
- `.interest-btn.interested:hover`: slightly lighter ‚Äî `background: #3d8b6a`.
- `.interest-btn:hover` (not interested): `background: #e8f5e9`.
- `.interest-btn:disabled`: `opacity: 0.6; cursor: default;`

**`.interest-count`:**
- `font-size: 0.82rem`
- `font-weight: 700`
- `color: #2d6a4f`

**`.interest-count-label`:**
- `font-size: 0.82rem`
- `color: #888`

**`.contact-btn`** (updated ‚Äî now a secondary/subtle style):
- `padding: 0.3rem 0.7rem`
- `font-size: 0.78rem`
- `font-weight: 600`
- `color: #666`
- `background: none`
- `border: 1.5px solid #ccc`
- `border-radius: 8px`
- `cursor: pointer`
- `transition: all 0.2s`
- `.contact-btn:hover`: `background: #f5f5f5; border-color: #999;`
- `.contact-btn:disabled`: `opacity: 0.6; cursor: default;`

Remove the old `.post-card.expanded .contact-btn` rule (this is now handled by the `.interest-actions` parent).

### 6. No other changes

- Do **not** modify any Go backend files.
- Do **not** modify `shared.css` or `shared.js`.
- Do **not** modify `village-day.html` or any other HTML files.

## Acceptance criteria

- On the dashboard, expanding an **offer** by another user shows:
  - A `"ü§ç I'm interested"` button, a count badge, and a `"üìß Contact"` button.
- Expanding a **request** by another user shows `"ü§ç I can help!"` instead.
- Clicking the interest button:
  - Toggles it to `"‚ù§ Interested"` with a filled green style.
  - Updates the count badge (e.g., 0 ‚Üí 1).
  - Shows a success toast.
- Clicking again toggles it back to the uninterested state (count goes down).
- The **Contact** button still opens the email client as before.
- **Own posts** with interest show a read-only `"‚ù§ 2 interested"` label (no buttons).
- **Own posts** with 0 interest show no interest UI.
- **Announcements** never show interest or contact buttons.
- When the card is **collapsed**, the interest actions are hidden.
- After page reload, the interest state persists (button shows "‚ù§ Interested" if `user_interested` is true in the API response).
- All existing functionality (expand/collapse, delete, create post, filters) still works.

## Constraints

- Vanilla JS only ‚Äî no frameworks, no build tools.
- All changes in `static/dashboard.html` only.
- Follow existing code style: `var` declarations, `for` loops, string concatenation for HTML.
- The interest button must be keyboard-accessible (it's a `<button>`, so this is automatic).
- Keep the interest toggle optimistic-feeling: disable button briefly during the request, but re-enable quickly on success.
